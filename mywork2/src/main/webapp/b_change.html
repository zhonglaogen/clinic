<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/puyuan.css">
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/tools.js"></script>
</head>
<body>
<br/><br/>
<!--标题-->
<div class="navbar-centerl">
    <img class="isize" src="img/logo.png" style="display:inline">
    <h1 style="display:inline">何庄子诊所在线系统</h1>
</div>
<br/><br/>
<!--导航栏-->
<div class="menuk">
    <ul class="menu">
        <li><a href="home.html" class="dbt">网站首页</a></li>
        <li><a href="home.html" class="dbt">医院概况</a>
        </li>
        <li><a href="doctor.html" class="dbt">医生团队</a>
        </li>
        <li><a href="book.html" class="dbt">预约挂号</a>
        </li>
        <ul class="navbar-centerl1">
            <li><a href="login.html" class="dbt">登录</a></li>
            <li><a href="registered.html" class="dbt">注册</a></li>
        </ul>
    </ul>
    <div class="clear"></div>
</div>
<!--巨幕-->
<div class="jumbotron big-screen">
    <img src="img/eyes.jpg">
</div>
<!--内容-->
<div class="container">
    <div class="row">
        <!--使导航栏与下方文本对齐-->
        <div class="col-sm-1"></div>
        <div class="col-sm-10 divcss">
            <br/><br/>
            <form class="login-form" action="#" method="post">
                <div id="wrong"></div>
                <h2>预约结果</h2>
                <br/>
                <table id="table1" width="550px" border="1">
                    <tr>
                        <td>oId</td>
                        <td>医生</td>
                        <td>就诊单号</td>
                        <td>就诊日期</td>
                        <td>预约日期</td>
                        <td>取消预约</td>
                    </tr>
                </table>
                <br/>
                <h2>以前预约结果</h2>
                <br/>
                <table id="table2" width="550px" border="1">
                    <tr>
                        <td>oId</td>
                        <td>医生</td>
                        <td>就诊单号</td>
                        <td>就诊日期</td>
                        <td>预约日期</td>
                        <td>预约结果</td>
                    </tr>
                </table>
                <br/>
                <input id="btn" class="login-btn" type="button" name="" style="width: 200px;margin-left:0" value="返回">
            </form>
            <br/>
        </div>
        <div class="col-sm-1"></div>
    </div>
</div>
<!--网页底部-->
<br/><br/>
<div class="foot1">
    <div class="main">
        <i></i>
        <div class="d1">
            <div class="bt1"><span class="s1">联系方式</span></div>
            <div class="lx_nr">
                <ul>
                    <li>地址：xxxxxxxxxxxxxxxxxxxxx</li>
                    <li>邮编：000000</li>
                    <li>电话：0022-00009999</li>
                    <li>传真：0224-00009999</li>
                    <li>Email：<a href="mailto:szwkyy@gmail.com">333@gmail.com</a></li>
                </ul>

            </div>
            <ul class="lb_wx">
                <li style="margin-right: 10px;"><img src="/img/em_wx2.jpg">
                    <p>ym</p></li>
                <li style="margin-right: 10px;"><img src="/img/em_xl2.jpg">
                    <p>zlx</p></li>
                <li style="margin-right: 10px;"><img src="/img/em_fyapp.png">
                    <p>zzj</p></li>
            </ul>
        </div>
        <div class="d2">
            <div class="bt1"><span class="s1">333专区</span></div>
            <ul class="lm1">
                <li><a class="cd_z1" target="_blank"><span>ym</span></a></li>
                <li><a class="cd_z1" target="_blank"><span>zlx</span></a></li>
                <li><a class="cd_z1" target="_blank"><span>zzj</span></a></li>
            </ul>
        </div>
        <div class="clear"></div>
    </div>
</div>
<div class="foot2">
    <div class="main">
        <ul class="cd_f1">
        </ul>
        <span class="s2 dbt"><a target="_blank"
                                href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33030202000591"><img
                src="/img/ba_03.png"/><p>天津公网安备 7e333666号</p></a></span>
        <span class="s1">版权所有：7E333<br>  Copyright &copy; 2017 Wenzhou DongHua Hospital</span>
        <div class="clear"></div>
    </div>
</div>
</body>
<script type="text/javascript">
    function add0(m){return m<10?'0'+m:m }
    function timeFormat(timestamp){
        //timestamp是整数，否则要parseInt转换,不会出现少个0的情况
        var time = new Date(timestamp);
        var year = time.getFullYear();
        var month = time.getMonth()+1;
        var date = time.getDate();
        return year+'-'+add0(month)+'-'+add0(date);
    }
    function del() {
        var table1 = document.getElementById("table1");
        var btn = table1.getElementsByTagName("input");
        for (var j = 0; j < btn.length; j++) {
            btn[j].index = j;
            console.log(btn[j].index);
            btn[j].onclick = function () {
                // console.log(this.parentNode.parentNode.childNodes[1].innerHTML);
                var oId = this.parentNode.parentNode.childNodes[0].innerHTML;
                var doctor = this.parentNode.parentNode.childNodes[1].innerHTML;
                var week = this.parentNode.parentNode.childNodes[2].innerHTML;
                var btnchoose = confirm("您是否要取消在" + week + doctor + "医生的预约");
                if (btnchoose == true) {
                    $.ajax({
                        url: "patient/cancelorder.action",
                        contentType: "application/json;charset-UTF-8",
                        dataType: "json",
                        data: JSON.stringify({oId:oId}),
                        type: "POST",
                        success: function (data) {
                            remove();
                            console.log(data);
                            alert("已取消预约");
                        }
                    });
                } else {
                    alert("操作已取消");
                }
            }
        }
    }
    $("#btn").on("click", function () {
        window.location.href = "book.html";
    });
        $(document).ready(function () {
        });
    //解析科室医生信息
    $.ajax({
        url: "patient/showvalidapply.action",
        contentType: "application/json;charset-UTF-8",
        dataType: "json",
        type: "POST",
        success: function (data) {
            var table1 = document.getElementById("table1");
            for (var i = 0; i < data.length; i++) {
                var row = table1.insertRow(table1.rows.length);
                var c1 = row.insertCell(0);
                c1.innerHTML = data[i].patientOrder.oId;
                var c2 = row.insertCell(1);
                c2.innerHTML = data[i].doctor.dName;
                var c3 = row.insertCell(2);
                c3.innerHTML = data[i].patientOrder.tId;
                var c4 = row.insertCell(3);
                c4.innerHTML = timeFormat(data[i].itemOutTreate.iDate)+ "/" + data[i].itemOutTreate.iUpDown;
                var c5 = row.insertCell(4);
                c5.innerHTML = timeFormat(data[i].patientOrder.oDate);
                var c6 = row.insertCell(5);
                // console.log(data[i].Quantity !== "true");
                if (data[i].patientOrder.oGo == false) {
                    c6.innerHTML = '<input type="button" value="取消预约" class="login-btn">';
                } else {
                    c6.innerHTML = "已排好";
                }
            }
            del();
            $('#table1 tr').find('td:eq(0)').hide();
        }
    });
    $.ajax({
        url: "patient/showinvalidapply.action",
        contentType: "application/json;charset-UTF-8",
        dataType: "json",
        type: "POST",
        success: function (data) {
            var table2 = document.getElementById("table2");
            for (var i = 0; i < data.length; i++) {
                var row = table2.insertRow(table2.rows.length);
                var c1 = row.insertCell(0);
                c1.innerHTML = data[i].patientOrder.oId;
                var c2 = row.insertCell(1);
                c2.innerHTML = data[i].doctor.dName;
                var c3 = row.insertCell(2);
                c3.innerHTML = data[i].patientOrder.tId;
                var c4 = row.insertCell(3);
                c4.innerHTML = timeFormat(data[i].itemOutTreate.iDate)+ "/" + data[i].itemOutTreate.iUpDown;
                var c5 = row.insertCell(4);
                c5.innerHTML = timeFormat(data[i].patientOrder.oDate);
                var c6 = row.insertCell(5);
                if (data[i].patientOrder.oGo) {
                    c6.innerHTML = "已排号";
                } else {
                    c6.innerHTML = "未到";
                }
            }
            $('#table2 tr').find('td:eq(0)').hide();
        }
    });
</script>
</html>